name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Debug workspace (temporary)
        run: |
          pwd
          ls -la
          echo "---- recursive ----"
          ls -R | head -n 200

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        if: hashFiles('requirements.txt') != ''
        run: pip install -r requirements.txt

      # If you use pytest (recommended)
      - name: Run tests with pytest (if tests/ exists)
        if: ${{ hashFiles('tests/**') != '' }}
        run: |
          pip install pytest
          pytest -q

      # Fallback: if you have a single test.py at repo root
      - name: Run test.py (fallback)
        if: ${{ hashFiles('test.py') != '' }}
        run: python3 test.py

      # Optional: fail with a clear message if neither exists
      - name: No tests found
        if: ${{ hashFiles('tests/**') == '' && hashFiles('test.py') == '' }}
        run: |
          echo "No tests detected. Add a tests/ directory for pytest or a test.py at repo root."
          exit 1

      - name: Post script
        run: |
          echo "Add other actions to build,"
          echo "test, and deploy your project."
